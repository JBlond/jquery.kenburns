/*!
 * jQuery Ken Burns plugin
 * http://labs.codapixa.com/jquery.kenburns
 *
 * Licensed under MIT License http://opensource.org/licenses/mit-license.php
 * Copyright (c) 2012 Codapixa
 *
 * Version: 0.1
 * Author: Firman W <firmanw@codapixa.com>
 *
 * Version 0.2
 * Author: https://github.com/JBlond/jquery.kenburns
 */
(function(c){var b=function(e,d){this.target=e;this.options=c.extend({},this.defaults,d);this.init();return this};b.prototype={defaults:{duration:7000,width:940,height:360,align:"random",zoom:1.1,debug:false},canvas:null,image:null,interval:0,actual:{},state:"init",time:0,scale:1,align:"center",init:function(){var d=this;c("<img />").attr("src",c(d.target).attr("src")).load(function(){if(d.canvas===null){c(d.target).hide();d.canvas=c("<canvas />")[0];c(d.canvas).appendTo(c(d.target).parent())}d.image=this;d.canvas.width=d.options.width;d.canvas.height=d.options.height;d.actual.width=d.canvas.width;d.actual.height=Math.floor((d.canvas.width/d.image.width)*d.image.height);d.actual.x=(d.actual.width-d.canvas.width)/2*-1;d.actual.y=(d.actual.height-d.canvas.height)/2*-1;d.start()})},_context:function(){return this.canvas.getContext("2d")},_redraw:function(){var e=this,d=e._context();d.clearRect(0,0,e.canvas.width,e.canvas.height);d.drawImage(e.image,0,0,e.image.width,e.image.height,e.actual.x,e.actual.y,e.actual.width,e.actual.height);d.save()},_log:function(d){if(this.options.debug){console.log("jQuery.kenburns > %s",d)}},start:function(){if(this.state=="finish"){return}if(this.time===0){this._redraw()}this.exec()},exec:function(){var e=this,d=e._context(),i=function(j){var k=new Date();return k.getTime()-j},h=function(j,q,k,n,o,l,m){var r=0;var p=0;switch(m){case"top":r=(o-k)/2*-1;break;case"left":p=(l-n)/2*-1;break;case"bottom":r=(o-k)/2*-1;p=(l-n)*-1;break;case"right":r=(o-k)*-1;p=(l-n)/2*-1;break;default:r=(o-k)/2*-1;p=(l-n)/2*-1;break}return{x:j+r,y:q+p}},g=["top","left","center","bottom","right"],f=function(l,j,k){sw=Math.floor(l.width*j);sh=Math.floor(l.height*j);a=h(l.x,l.y,l.width,l.height,sw,sh,k);return{x:a.x,y:a.y,width:sw,height:sh}};if(e.state!="animate"){if(e.options.align=="random"){e.align=g[Math.floor(Math.random()*g.length)]}else{e.align=e.options.align}}if(e.time===0){e.time=i(0)}e.state="animate";e.interval=setInterval(function(){var j=f(e.actual,e.scale,e.align),k=i(e.time);e._log("State: "+e.state+", Passed: "+k+", Scale: "+e.scale+", Align: "+e.align);d.drawImage(e.image,0,0,e.image.width,e.image.height,j.x,j.y,j.width,j.height);d.save();if(k>=e.options.duration){e.state="finish";clearInterval(e.interval);return false}e.scale+=(Math.abs(e.options.zoom-1)/e.options.duration)*30},30)},set:function(d){this.options=c.extend(this.options,d)},reset:function(){this.scale=1;this.time=0;this.state="reset";clearInterval(this.interval);this.start()},pause:function(){clearInterval(this.interval)},stop:function(){this.scale=1;this.time=0;this.state="stop";clearInterval(this.interval)}};c.fn.kenburns=function(d){var e=arguments;return this.each(function(){var f=c(this).data("kenburns")||{};if(f[d]){return f[d].apply(f,Array.prototype.slice.call(e,1))}else{if(typeof d==="object"||!d){f=new b(this,d);c(this).data("kenburns",f);return this}else{c.error("Method "+method+" does not exist on jQuery.kenburns")}}})}})(jQuery);